# Palworld Host Save Fix

> ### :warning: 请任何时候都提前备份好自己的存档数据！

本工具主要用于存档迁移，有如下几种场景的场景：
- 将原邀请码模式的多人游戏存档，迁移到新建的专属服务器模式。  // 下面将主要说明该场景的操作方法，主要面向那些前期使用邀请码模式和小伙伴玩耍的同学，在搭建专用服务器后，可以接着之前的进度继续玩。
- 将存档在Windows/Linux专属服务器模式间迁移.

本工具迁移存档的工作逻辑：
- 在新服务器创建的世界中新建一个角色，产生一个新的存档文件（新的GUID）。
- 将原存档数据（旧的GUID）解码，提取数据，再编码覆盖新GUID的存档文件。


## 使用方法

软件依赖:
- Python 3
- [uesave-rs](https://github.com/trumank/uesave-rs)

命令行说明:    
`python fix-host-save.py <uesave.exe> <save_path> <new_guid> <old_guid>`    
`<uesave.exe>` - Path to your uesave.exe    // ussave的安装路径

`<save_path>` - Path to your save folder    // 存档文件夹路径，为了安全起见，这里作者建议将存档数据拷贝到一个临时文件夹下进行操作，此处就输入临时文件夹路径  

`<new_guid>` - GUID of the player on the new server    // 新的GUID

`<old_guid>` - GUID of the player from the old server  // 旧的GUID，对于邀请码模式，房主的GUID默认为00000000000000000000000000000001，其他玩家的GUID随机，且在他们自己的电脑上无法找到，GUID和存档文件都在房主的主机上，如果想要确认各个小伙伴的GUID，可以安排先后进入原邀请码模式，观察存档文件的刷新时间，来判断对应关系，这样才能在后续迁移后恢复各自的存档不产生错乱

命令行样例:    
`python fix-host-save.py "C:\Users\John\.cargo\bin\uesave.exe" "C:\Users\John\Desktop\my_temporary_folder\2E85FD38BAA792EB1D4C09386F3A3CDA" 6E80B1A6000000000000000000000000 00000000000000000000000000000001`

## 将原邀请码模式的多人游戏存档，迁移到新建的专属服务器模式（Windows服务器） // Linux服务器请自行类推

前置条件:
- 安装好了Python3和uesave。
- 专属服务器已经安装好，并且可以正常运行，且可以连接并进入游戏。


迁移操作步骤: //先迁移原房主的存档
1. Copy your desired save's folder from `C:\Users\<username>\AppData\Local\Pal\Saved\SaveGames\<random_numbers>` to your dedicated server. 把房主本地的存档文件夹复制到专属服务器的一个临时目录。
2. In the `PalServer\Pal\Saved\Config\WindowsServer\GameUserSettings.ini` file, change the `DedicatedServerName` to match your save's folder name. For example, if your save's folder name is `2E85FD38BAA792EB1D4C09386F3A3CDA`, the `DedicatedServerName` changes to `DedicatedServerName=2E85FD38BAA792EB1D4C09386F3A3CDA`.
3. Delete `PalServer\Pal\Saved\SaveGames\0\<your_save_here>\WorldOption.sav` to allow modification of `PalWorldSettings.ini`. Players will have to choose their respawn point again, but nothing else is affected as far as I can tell.
4. Confirm you can connect to your save on the dedicated server and that the world is the one in the save. You can check the world with a character that belongs to a regular player from the co-op.
5. Afterwards, the co-op host must create a new character on the dedicated server. A new `.sav` file should appear in `PalServer\Pal\Saved\SaveGames\0\<your_save_here>\Players`.
6. The name of that new `.sav` file is the co-op host's new GUID. We will need the co-op host's new GUID for the script to work.
7. Shut the server down and then copy the entire dedicated server save at `PalServer\Pal\Saved\SaveGames\0\<your_save_here>` (it must be the save with the co-op host's new character!) into a temporary folder and remember the path for the temporary folder because it's needed to run the script.
8. If you have not already done so, install [uesave-rs](https://github.com/trumank/uesave-rs) and get the file path to its install location. If the path does not have `uesave.exe` at the end, it's wrong.
9. **Make a backup of your save!** This is an experimental script and has known bugs so always keep a backup copy of your save.
10. Run the script using the command in the [Usage section](#usage) with the information you've gathered and using `00000000000000000000000000000001` as the co-op host's old GUID.
11. Copy the save from the temporary folder back to the dedicated server. Move the save you had in the dedicated server somewhere else or rename it to something different.
12. Start the server back up and have the co-op host join the server with their fixed character.
13. If, after 5 minutes of play, your Pals won't attack for you or do work in the base, follow the [\[Pal bug\] workaround](#pal-bug) to fix them.

